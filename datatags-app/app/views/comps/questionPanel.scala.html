@import edu.harvard.iq.datatags.externaltexts.Localization
@import edu.harvard.iq.datatags.model.graphs.nodes.AskNode
@(questionNode:AskNode, versionKit:VersionKit, loc:Option[Localization],
        answerHistory:Seq[AnswerRecord], enableComments:Boolean, interactive:Boolean, showId:Boolean, allowNotes:Boolean, note:Option[String])

<div class="card m-2 border-secondary questionPanel">
  <div class="card-header bg-secondary text-white d-flex">
    <div class="flex-grow-1">
      Question: Please select one answer
    </div>
    @if( showId ){
      <div><span class="badge badge-light">@questionNode.getId</span></div>
    }
    @if( enableComments ){
      <div class="ml-2">
      @comps.comments("cmnt_" + questionNode.getId.filter(Character.isLetterOrDigit), versionKit.md.id.modelId, versionKit.md.id.version, None, "node", questionNode.getId, "btn-outline-light")
      </div>
    }
  </div>
  <div class="card-body">
    @defining( loc.map(_.getNodeText(questionNode.getId))
                  .flatMap(jop=>if(jop.isPresent) Some(jop.get) else None)
                  .getOrElse(Helpers.askNodeToMarkdown(questionNode))){ nodeText =>
      @Helpers.renderMarkdown( nodeText )
    }
  </div>
  @helper.form( action=routes.InterviewCtrl.answer(versionKit.md.id.modelId, versionKit.md.id.version, questionNode.getId), 'id->"answerForm" ) {
    <div class="card-body noteCtnr" id="noteDiv" @if(note.isEmpty) {style="display: none" }>
        <textarea placeholder="Annotate your answer here" name="note" class="form-control" rows="2">@note.getOrElse("")</textarea>
    </div>
    <div class="card-footer">
      <div class="answerButtonCtnr">
        @if(allowNotes){
          <button type="button" class="toggleNoteBtn" onclick="$('#noteDiv').slideToggle(); $('#noteDiv textarea').focus()"><i class="fa fa-pencil"></i> Add note</button>
        }
        @for( ans <- questionNode.getAnswers ) {
          <button type="button" @if(interactive){ class="btn btn-primary"
            onclick="$('#answerText')[0].value='@ans.getAnswerText'; $('#answerForm').submit();"}else{ class="btn btn-outline-primary" disabled} >
          @loc.map( l=>l.localizeAnswer(ans.getAnswerText)).getOrElse(Helpers.makeUpper(ans.getAnswerText))</button>
        }
      </div>
      @if( interactive ) {
        <input type="hidden" name="answerText" id="answerText" value="" />
        <input type="hidden" name="serializedHistory" id="serializedHistory" value="@versionKit.serializer.encode(answerHistory)"/>
      }
    </div>
  }
</div>
