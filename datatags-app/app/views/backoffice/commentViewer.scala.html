@import edu.harvard.iq.datatags.externaltexts.Localization
@import edu.harvard.iq.datatags.externaltexts.MarkupString
@import edu.harvard.iq.datatags.model.graphs.nodes.AskNode
@import edu.harvard.iq.datatags.model.graphs.nodes.RejectNode
@(cmt:Comment, qKit:PolicyModelVersionKit, locOpt:Option[Localization], readmeOpt:Option[MarkupString])

@templates.backend("Version Viewer", 'backOffice ) {
  <div class="row my-2">
    <div class="col">
      <a href="@routes.PolicyKitManagementCtrl.showVersionPage(qKit.id.modelId, qKit.id.version)">
        <i class="fa fa-arrow-left"></i> @{Option(qKit.model).map(_.getMetadata.getTitle ).getOrElse(qKit.id.modelId + "/" + qKit.id.version)}
      </a>
      <h3>
        <div class="float-right">
          <button class="btn btn-secondary"
                  onclick="Comments.setResolved(this, 'commentStatus', @cmt.id, @if(cmt.resolved){false}else{true})">
                  Mark as @if(cmt.resolved){Unresolved}else{Resolved}</button>
          <button class="btn btn-danger"
                  onclick="Comments.deleteComment('@cmt.id', '@qKit.id.modelId', '@qKit.id.version')">
                  Delete Comment</button>
        </div>
        Comment @comps.commentStatus(cmt, Some("commentStatus"))
      </h3>
      <div>
        <em>@cmt.writer</em> commented at @Helpers.dateTimeFormat(cmt.time)
        on <code>@cmt.targetType.trim/@cmt.targetContent.trim</code>
        @locOpt.map( loc=>"(localization: "+ loc.getLanguage + ")")
      </div>
      <div class="commentContent">
        @cmt.comment
      </div>
      <hr>
    </div>
  </div>

  <div class="row my-2">
    <div class="col">
      <h4>Comment Context</h4>
      <div class="commentSubjectCtnr">
        @if(cmt.targetType.trim == "meta"){
          @cmt.targetContent.trim match {
            case "policy-space" => {@comps.tagType(qKit.model.getSpaceRoot, locOpt)}
            case "readme" => {
              @if(readmeOpt.isDefined) {
                @Helpers.render(readmeOpt.get)
              } else {
                <div class="alert alert-warning">README missing</div>
              }
            }
          }
        } else {
          @defining(qKit.model.getDecisionGraph.getNode(cmt.targetContent)) {
            case ask: AskNode => {
              @comps.questionPanel(ask, qKit, locOpt, Seq(), enableComments=false, interactive=false, showId = true)
            }
            case rej: RejectNode => {
              @comps.rejectPanel(rej, qKit, locOpt, Seq(), enableComments=false)
            }
          }
        }
      </div>
    </div>
  </div>
}
