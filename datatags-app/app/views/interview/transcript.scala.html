@import  edu.harvard.iq.datatags.runtime.RuntimeEngineStatus
@( session:InterviewSession,
        notes: Map[String,Note]
)(implicit req:Request[_])

@scripts = {
  <script type="text/javascript" src="@routes.Application.javascriptRoutes"></script>
  <script type="text/javascript" src="@routes.Assets.at("js/Question.js")"></script>
}

@templates.bsNavBar("Interview Transcript", 'ask, scripts) {
  <div class="row my-2">
    <div class="col">
      <h2>
        <div class="pull-right">
          <a class="btn btn-sm btn-outline-dark" href="@routes.InterviewCtrl.transcript(session.kit.id.modelId, session.kit.id.version, Some("xml"))">
            <i class="fa fa-code"></i>
            Download as xml
          </a>
        </div>
        Interview Transcript</h2>
      Model <strong>@session.kit.id.modelId version @session.kit.id.version</strong>
    </div>
  </div>
  <div class="row my-2">
    <div class="col">
      <div class="card">
        @defining( session.engineState.getStatus == RuntimeEngineStatus.Accept ) { accepted =>
          <div class="card-header @if(accepted){bg-success}else{bg-danger} text-white">
            Result @if(!accepted){ - Rejection}
          </div>
          <div class="card-body">
            @comps.tagValue(session.tags, session.localization)
          </div>
        }
      </div>
    </div>
  </div>
  <div class="row my-2">
    <div class="col transcript">
      @for( ans <- session.answerHistory ) {
        <div class="question">
          @defining( session.localization.map(_.getNodeText(ans.question.getId))
                    .flatMap(jop=>if(jop.isPresent) Some(jop.get) else None)
                    .getOrElse(Helpers.askNodeToMarkdown(ans.question))
          ){ nodeText =>
            <div class="text">
              @Helpers.renderMarkdown( nodeText )
            </div>
          }
          @if( notes.contains(ans.question.getId) ){
            <div class="questionSection questionSectionNote">
              <h6>Note</h6>
              <div class="text">
                @notes(ans.question.getId).note
              </div>
            </div>
          }
          <div class="questionSection questionSectionAnswer">
            <h6>Answer</h6>
            <div class="text">
              @session.localization.map( l=>l.localizeAnswer(ans.answer.getAnswerText)
                     ).getOrElse(Helpers.makeUpper(ans.answer.getAnswerText))
            </div>
          </div>
        </div>
      }

    </div>
  </div>
}
